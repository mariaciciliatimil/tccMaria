import jwt from 'jsonwebtoken'; export function authRequired(req,res,next){const a=req.headers.authorization||'';const t=a.startsWith('Bearer ')?a.slice(7):null; if(!t) return res.status(401).json({error:'Token não informado'}); try{req.user=jwt.verify(t,process.env.JWT_SECRET); next();}catch(e){return res.status(401).json({error:'Token inválido'});} } export function allowRoles(...roles){return (req,res,next)=>{ if(!req.user||!roles.includes(req.user.role)) return res.status(403).json({error:'Acesso negado'}); next(); } }
